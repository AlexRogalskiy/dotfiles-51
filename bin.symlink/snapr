#!/usr/bin/env ruby

require 'open-uri'

# snapr
# Version 0.1
# Adam Jahnke - https://github.com/adamyonk
#
# Requirements
#   - A DROPBOX_USER_ID environment variable in ~/.localrc
#   - Your OS X screenshots directory set to ~/Dropbox/Public/Screenshots

path = `defaults read com.apple.screencapture location | awk '{printf "%s", $0}'`
dropbox_user = `grep 'DROPBOX_USER_ID' ~/.localrc | awk 'BEGIN { FS = "=" } ; { printf $2 }'`
filename = `basename #{URI::encode Dir["#{path}/*"].sort_by{ |f| File.mtime(f) }.last}`
url = "https://dl.dropbox.com/u/#{dropbox_user}/Screenshots/#{filename}"
`echo "#{url}" | pbcopy`
