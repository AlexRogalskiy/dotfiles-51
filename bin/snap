#!/usr/bin/env ruby

# snap
# Version 0.1
# Adam Jahnke - http://github.com/adamyonk

require 'trollop'
require 'uri'

opts = Trollop::options do
  version '0.1'
  banner <<-EOS
Copies link to last screenshot to clipboard (Mac)

Requires:
  - A 'Public' directory in Dropbox
  - A 'Screenshots' directory inside 'Public'
  - A DROPBOX_USER_ID environment variable

Usage:
  snap
EOS
end

path = Dir.glob("#{Dir.home}/Dropbox/Public/Screenshots/*.png").max_by {|f| File.mtime(f)}
filename = URI::escape(File.basename(path))
url = "https://dl.dropbox.com/u/#{`printf $DROPBOX_USER_ID`}/Screenshots/#{filename}"

`echo #{url} | pbcopy`
